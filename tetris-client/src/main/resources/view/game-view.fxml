<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<!--
    테트리스 게임 화면
    - 왼쪽: 게임 보드 (GridPane)
    - 오른쪽: 점수, 레벨, 라인 정보
    - 중앙: 게임 오버 메시지 (평소에는 숨김)
-->
<BorderPane fx:id="rootPane"
            xmlns="http://javafx.com/javafx/21" 
            xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="seoultech.se.client.controller.GameController"
            styleClass="game-background"
            stylesheets="@../css/application.css, @../css/game-view.css">
    
    <!-- 상단: 제목 -->
    <top>
        <Label text="TETRIS" styleClass="game-title" alignment="CENTER" />
    </top>
    
    <!-- 중앙: 게임 보드와 정보 -->
    <center>
        <HBox styleClass="game-main-container" alignment="CENTER" BorderPane.alignment="CENTER">
            
            <!-- 왼쪽: Hold 영역 -->
            <VBox styleClass="hold-container" alignment="TOP_CENTER">
                <Label text="HOLD" styleClass="info-label-title" alignment="CENTER"/>
                <GridPane fx:id="holdGridPane" 
                         styleClass="preview-board"
                         alignment="CENTER">
                </GridPane>
            </VBox>
            
            <!-- 게임 보드 (StackPane으로 오버레이 구현) -->
            <StackPane fx:id="gameStackPane">
                <!-- 실제 테트리스 보드 (10x20 그리드) - 배경 -->
                <GridPane fx:id="boardGridPane" 
                         styleClass="game-board"
                         focusTraversable="true"
                         alignment="CENTER">
                    <!-- 
                        이 GridPane은 GameController의 initializeGridPane()에서 
                        Rectangle들로 채워집니다 (10열 x 20행)
                    -->
                </GridPane>
                
                <!-- 게임 오버 메시지 (평소에는 숨김) - 중앙 배치 -->
                <Label fx:id="gameOverLabel" 
                       text="GAME OVER" 
                       styleClass="game-over-label" 
                       StackPane.alignment="CENTER"
                       alignment="CENTER"
                       visible="false"
                       managed="false"
                       mouseTransparent="false"/>
                
                <!-- 상단 이벤트 알림 영역 -->
                <VBox alignment="TOP_CENTER" styleClass="event-notification-container"
                      pickOnBounds="false"
                      mouseTransparent="true"
                      StackPane.alignment="TOP_CENTER">
                    
                    <!-- 첫 번째 라인: Combo + Back-to-Back -->
                    <HBox fx:id="topEventLine" alignment="CENTER" styleClass="event-line-container"
                          visible="false" managed="false">
                        <Label fx:id="comboLabel" 
                               text="" 
                               styleClass="combo-label" 
                               alignment="CENTER"
                               visible="false"
                               managed="false"/>
                        <Label fx:id="backToBackLabel" 
                               text="" 
                               styleClass="back-to-back-label" 
                               alignment="CENTER"
                               visible="false"
                               managed="false"/>
                    </HBox>
                    
                    <!-- 두 번째 라인: Line Clear Type (T-Spin, TETRIS 등) -->
                    <Label fx:id="lineClearTypeLabel" 
                           text="" 
                           styleClass="line-clear-type-label" 
                           alignment="CENTER"
                           visible="false"
                           managed="false"/>
                    
                    <!-- 세 번째 라인: Line Clear Notification -->
                    <Label fx:id="lineClearNotificationLabel" 
                           text="" 
                           styleClass="line-clear-notification-label" 
                           alignment="CENTER"
                           visible="false"
                           managed="false"/>
                </VBox>
                
                <!-- Pause 팝업 오버레이 (평소에는 숨김) -->
                <VBox fx:id="pauseOverlay" 
                      alignment="CENTER" 
                      styleClass="popup-overlay"
                      visible="false"
                      managed="false"
                      StackPane.alignment="CENTER">
                    <VBox alignment="CENTER" styleClass="popup-container">
                        <Label text="PAUSED" styleClass="popup-title"/>
                        <Button text="Resume" styleClass="menu-button-middle" onAction="#handleResumeFromOverlay"/>
                        <Button text="Quit" styleClass="menu-button-middle" onAction="#handleQuitFromOverlay"/>
                    </VBox>
                </VBox>
                
                <!-- Game Over 팝업 오버레이 (평소에는 숨김) -->
                <VBox fx:id="gameOverOverlay" 
                      alignment="CENTER" 
                      styleClass="popup-overlay"
                      visible="false"
                      managed="false"
                      StackPane.alignment="CENTER">
                    <VBox alignment="CENTER" styleClass="popup-container">
                        <Label text="GAME OVER" styleClass="popup-title"/>
                        <Label text="Your Score" styleClass="popup-label"/>
                        <Label fx:id="finalScoreLabel" text="0" styleClass="popup-score"/>
                        <HBox styleClass="gameover-buttons" alignment="CENTER">
                            <Button text="Main" styleClass="menu-button-small" onAction="#handleMainFromOverlay"/>
                            <Button text="Restart" styleClass="menu-button-small" onAction="#handleRestartFromOverlay"/>
                        </HBox>
                    </VBox>
                </VBox>
                
                <!-- Mode Selection 팝업 오버레이 (평소에는 숨김) -->
                <VBox fx:id="modeSelectionOverlay" 
                      alignment="CENTER" 
                      styleClass="popup-overlay"
                      visible="false"
                      managed="false"
                      StackPane.alignment="CENTER">
                    <!-- ModeSelectionPopup 컴포넌트가 여기에 동적으로 추가됨 -->
                </VBox>
            </StackPane>
            
            <!-- 오른쪽: 게임 정보 -->
            <VBox styleClass="info-panel" alignment="TOP_CENTER">
                <!-- Next 영역 -->
                <VBox styleClass="info-section" alignment="CENTER">
                    <Label text="NEXT" styleClass="info-label-title" alignment="CENTER"/>
                    <GridPane fx:id="nextGridPane" 
                             styleClass="preview-board"
                             alignment="CENTER">
                    </GridPane>
                </VBox>
                
                <!-- 점수 -->
                <VBox styleClass="info-section" alignment="CENTER">
                    <Label text="SCORE" styleClass="info-label-title" alignment="CENTER"/>
                    <Label fx:id="scoreLabel" text="0" styleClass="info-label-value" alignment="CENTER"/>
                </VBox>
                
                <!-- 레벨 -->
                <VBox styleClass="info-section" alignment="CENTER">
                    <Label text="LEVEL" styleClass="info-label-title" alignment="CENTER"/>
                    <Label fx:id="levelLabel" text="1" styleClass="info-label-value" alignment="CENTER"/>
                </VBox>
                
                <!-- 지운 줄 수 -->
                <VBox styleClass="info-section" alignment="CENTER">
                    <Label text="LINES" styleClass="info-label-title" alignment="CENTER"/>
                    <Label fx:id="linesLabel" text="0" styleClass="info-label-value" alignment="CENTER"/>
                </VBox>
                
                <!-- 조작법 안내 -->
                <VBox styleClass="controls-section" alignment="CENTER">
                    <Label text="CONTROLS" styleClass="info-label-title"/>
                    <VBox styleClass="controls-info">
                        <Label text="← → : Move" styleClass="control-text"/>
                        <Label text="↓ : Soft Drop" styleClass="control-text"/>
                        <Label text="↑ : Rotate CW" styleClass="control-text"/>
                        <Label text="Z : Rotate CCW" styleClass="control-text"/>
                        <Label text="Space : Hard Drop" styleClass="control-text"/>
                        <Label text="C : Hold" styleClass="control-text"/>
                        <Label text="P : Pause" styleClass="control-text"/>
                    </VBox>
                </VBox>
            </VBox>
        </HBox>
    </center>
</BorderPane>
